keep_long$Pro_pep <- keep_long$Proinsulin_pM_L/keep_long$PEP0_pM_L*100
# merge  datasets
alldata <- merge(keep_ppt,keep_long,by="Random_ID",all.x=F,all.y=F)
N <- length(unique(alldata$Random_ID))
# fix gender coding female Female   male   Male
alldata$Gender[alldata$Gender=='female'] <- "Female"
alldata$Gender[alldata$Gender=='male'] <- "Male"
# new variable for DR3/DR4
alldata$DR3DR4[alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT"] <- "PRESENT"
alldata$DR3DR4[!(alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT")] <- "ABSENT"
# combine race/ethnicity
alldata$race_eth <- NA
alldata$race_eth[(alldata$Race=="White" && alldata$Ethnicity=="Non-Hispanic origin")]  <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic White")] <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity == "Not Hispanic or Latino")] <- "NHW"
alldata$race_eth[alldata$Ethnicity=="Hispanic" | alldata$Ethnicity=="Hispanic or Latino" | alldata$Ethnicity=="Hispanic/Latino/Spanish origin"] <- "Hispanic"
alldata$race_eth[is.na(alldata$race_eth)] <- "Other"
View(alldata[c("Race","Ethnicity","race_eth")])
# combine race/ethnicity
alldata$race_eth <- NA
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic origin")]  <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic White")] <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity == "Not Hispanic or Latino")] <- "NHW"
alldata$race_eth[alldata$Ethnicity=="Hispanic" | alldata$Ethnicity=="Hispanic or Latino" | alldata$Ethnicity=="Hispanic/Latino/Spanish origin"] <- "Hispanic"
alldata$race_eth[is.na(alldata$race_eth)] <- "Other"
View(alldata[c("Race","Ethnicity","race_eth")])
# read in the data
longitudinal_visit_info <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\longitudinal 091818.csv")
ParticipantInfo_risk <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\Participant Info risk 091818.csv")
# get rid of duplicates
ParticipantInfo_risk <- unique(ParticipantInfo_risk)
# no duplicates
obslong <- nrow(longitudinal_visit_info)
nppt <- nrow(ParticipantInfo_risk)
# merge participant info and longitudinal data
keep_ppt <- data.frame(ParticipantInfo_risk$TrialNet,
ParticipantInfo_risk$T1D,
ParticipantInfo_risk$Date.of.Diagnosis,
ParticipantInfo_risk$DOB, ParticipantInfo_risk$Gender, ParticipantInfo_risk$Race, ParticipantInfo_risk$Ethnicity,
ParticipantInfo_risk$DPT1.Risk.Score,ParticipantInfo_risk$HLA, ParticipantInfo_risk$DR3,ParticipantInfo_risk$DR4)
colnames(keep_ppt) <- c("Random_ID","T1D","Date_of_Diagnosis","DOB","Gender",
"Race","Ethnicity","DPT1Risk","HLA","DR3","DR4")
keep_long <- data.frame(longitudinal_visit_info$PID,
longitudinal_visit_info$Draw.Date,
longitudinal_visit_info$GAD65,
longitudinal_visit_info$GAD65H,
longitudinal_visit_info$ICA512,
longitudinal_visit_info$IA2H,
longitudinal_visit_info$mIAA,
longitudinal_visit_info$ZnT8,
longitudinal_visit_info$ICA,
longitudinal_visit_info$U.per.MplusU.Ratio.Zen,
longitudinal_visit_info$ECL_GADA,
longitudinal_visit_info$ECL_IA.2A,
longitudinal_visit_info$ECL_IAA,
longitudinal_visit_info$Proinsulin_pM.L,
longitudinal_visit_info$PEP0)
colnames(keep_long) <- c("Random_ID","Draw_Date","GAD65","GAD65H","ICA512","IA_2H","mIAA","ZnT8","ICA","U_MplusU_Ratio_Zen","ECL_GADA","ECL_IA2A","ECL_IAA","Proinsulin_pM_L","PEP0")
# convert draw date to date
#keep_long$Draw_Date <- mdy_hms(as.character(keep_long$Draw_Date))
#keep_long$Draw_Date <- as.POSIXlt(as.character(keep_long$Draw_Date),format="%m%d%Y %H%M")
keep_long$Draw_Date <- mdy_hm(as.character(keep_long$Draw_Date))
keep_ppt$DOB <- mdy(as.character(keep_ppt$DOB))
# calculate fasting Cpeptide in pM/L
keep_long$PEP0_pM_L <- keep_long$PEP0*331.09
# calculate proinsulin/Cpep ratio
keep_long$Pro_pep <- keep_long$Proinsulin_pM_L/keep_long$PEP0_pM_L*100
# merge  datasets
alldata <- merge(keep_ppt,keep_long,by="Random_ID",all.x=F,all.y=F)
N <- length(unique(alldata$Random_ID))
# fix gender coding female Female   male   Male
alldata$Gender[alldata$Gender=='female'] <- "Female"
alldata$Gender[alldata$Gender=='male'] <- "Male"
# new variable for DR3/DR4
alldata$DR3DR4[alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT"] <- "PRESENT"
alldata$DR3DR4[!(alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT")] <- "ABSENT"
# combine race/ethnicity
alldata$race_eth <- NA
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic origin")]  <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic White")] <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity == "Not Hispanic or Latino")] <- "NHW"
alldata$race_eth[alldata$Ethnicity=="Hispanic" | alldata$Ethnicity=="Hispanic or Latino" | alldata$Ethnicity=="Hispanic/Latino/Spanish origin"] <- "Hispanic"
alldata$race_eth[is.na(alldata$race_eth)] <- "Other"
# labels
label(alldata$U_MplusU_Ratio_Zen)='INS ratio'
label(alldata$Pro_pep)='Proinsulin ratio'
label(alldata$Gender)='Gender'
label(alldata$DPT1Risk)="DPT1 Risk Score"
label(alldata$DR3)="DR3"
label(alldata$DR4)="DR4"
label(alldata$DR3DR4)="DR3/DR4"
# first code each antibody as positive negative
for(i in 1:nrow(alldata)){
###coding for miaa
a <-ifelse(is.na(alldata$mIAA[i]),
NA,
ifelse(alldata$mIAA[i] <= 0.01, 0, 1)
)
alldata$miaa_cat[i]<- a
###coding for first form of gad65
b <-ifelse(is.na(alldata$GAD65[i]),
NA,
ifelse(alldata$GAD65[i] <= 0.032, 0, 1)
)
alldata$gad65_cat[i]<- b
###coding for second form of gad65
c<-ifelse(is.na(alldata$GAD65H[i]),
NA,
ifelse(alldata$GAD65H[i] <= 20, 0, 1)
)
alldata$gad65h_cat[i]<- c
###coding for first form of ica512/ia2
d<-ifelse(is.na(alldata$ICA512[i]),
NA,
ifelse(alldata$ICA512[i] <= 0.049, 0, 1)
)
alldata$ica512_cat[i]<- d
###coding for second form of ica512/ia2
e<-ifelse(is.na(alldata$IA_2H[i]),
NA,
ifelse(alldata$IA_2H[i] <= 5, 0, 1)
)
alldata$ia2h_cat[i]<- e
###coding for znt8
f<-ifelse(is.na(alldata$ZnT8[i]),
NA,
ifelse(alldata$ZnT8[i] <= 0.02, 0, 1)
)
alldata$znt8_cat[i]<- f
}
#####combining both forms of gad65 tests
for(i in 1:nrow(alldata)){
test <- sum(alldata$ica512_cat[i],alldata$ia2h_cat[i],na.rm=TRUE)
de <- ifelse(is.na(alldata$ica512_cat[i]) & is.na(alldata$ia2h_cat[i]),
NA,
ifelse(test>=1,1,0))
alldata$ica512_ia2_cat[i]<- de
test2 <- sum(alldata$gad65_cat[i],alldata$gad65h_cat[i],na.rm=TRUE)
bc <- ifelse(is.na(alldata$gad65_cat[i]) & is.na(alldata$gad65h_cat[i]),
1,
ifelse(test2>=1,1,0))
alldata$GAD65_combo_cat[i]<- bc
}
# if all ab results missing, delete the record
misstwo <- alldata[is.na(alldata$mIAA) & is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$mIAA) | !is.na(alldata$miaa_cat) | !is.na(alldata$ica512_ia2_cat),]
# 36 records deleted
# check if anyone is missing GAD, ICA/IA2, or mIAA
missing <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
write.csv(missing,file="missing.csv")
# get rid of visits with missing mIAA data
missmiaa <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$GAD65_combo_cat) & !is.na(alldata$miaa_cat) & !is.na(alldata$ica512_ia2_cat),]
# 40 records deleted
# calculate number of positive ab at each visit
for(i in 1:nrow(alldata)){
alldata$numpos[i] <- sum(alldata$ica512_ia2_cat[i],alldata$GAD65_combo_cat[i],alldata$miaa_cat[i],alldata$znt8_cat[i],na.rm=T)
}
# calculate z-scores for GAD and IA2
alldata$gad65z <- (alldata$GAD65 - mean(alldata$GAD65,na.rm = TRUE))/sd(alldata$GAD65,na.rm = TRUE)
alldata$gad65hz <- (alldata$GAD65H - mean(alldata$GAD65H,na.rm = TRUE))/sd(alldata$GAD65H,na.rm = TRUE)
alldata$gadz <- ifelse(!is.na(alldata$GAD65),alldata$gad65z,alldata$gad65hz)
alldata$ica512z <- (alldata$ICA512 - mean(alldata$ICA512,na.rm = TRUE))/sd(alldata$ICA512,na.rm = TRUE)
alldata$ia2hz <- (alldata$IA_2H - mean(alldata$IA_2H,na.rm = TRUE))/sd(alldata$IA_2H,na.rm = TRUE)
alldata$ia2z <- ifelse(!is.na(alldata$ICA512),alldata$ica512z,alldata$ia2hz)
# need to find out if anyone is missing proinsulin ratio at all visits
sortds <- alldata[order(alldata$Random_ID,desc(alldata$Pro_pep)),]
View(sortds)
View(sortds)
hasproins <- sortds %>% group_by(Random_ID) %>% filter(row_number(Random_ID) == 1)
a <- hasproins[is.na(hasproins$Pro_pep),]
View(a)
View(a)
View(sortds[c("Random_ID","Pro_pep")])
View(hasproins)
View(hasproins)
View(hasproins[c("Random_ID","Pro_pep")])
View(a)
View(a)
# read in the data
longitudinal_visit_info <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\longitudinal 091818.csv")
ParticipantInfo_risk <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\Participant Info risk 091818.csv")
# get rid of duplicates
ParticipantInfo_risk <- unique(ParticipantInfo_risk)
# no duplicates
obslong <- nrow(longitudinal_visit_info)
nppt <- nrow(ParticipantInfo_risk)
# merge participant info and longitudinal data
keep_ppt <- data.frame(ParticipantInfo_risk$TrialNet,
ParticipantInfo_risk$T1D,
ParticipantInfo_risk$Date.of.Diagnosis,
ParticipantInfo_risk$DOB, ParticipantInfo_risk$Gender, ParticipantInfo_risk$Race, ParticipantInfo_risk$Ethnicity,
ParticipantInfo_risk$DPT1.Risk.Score,ParticipantInfo_risk$HLA, ParticipantInfo_risk$DR3,ParticipantInfo_risk$DR4)
colnames(keep_ppt) <- c("Random_ID","T1D","Date_of_Diagnosis","DOB","Gender",
"Race","Ethnicity","DPT1Risk","HLA","DR3","DR4")
keep_long <- data.frame(longitudinal_visit_info$PID,
longitudinal_visit_info$Draw.Date,
longitudinal_visit_info$GAD65,
longitudinal_visit_info$GAD65H,
longitudinal_visit_info$ICA512,
longitudinal_visit_info$IA2H,
longitudinal_visit_info$mIAA,
longitudinal_visit_info$ZnT8,
longitudinal_visit_info$ICA,
longitudinal_visit_info$U.per.MplusU.Ratio.Zen,
longitudinal_visit_info$ECL_GADA,
longitudinal_visit_info$ECL_IA.2A,
longitudinal_visit_info$ECL_IAA,
longitudinal_visit_info$Proinsulin_pM.L,
longitudinal_visit_info$PEP0)
colnames(keep_long) <- c("Random_ID","Draw_Date","GAD65","GAD65H","ICA512","IA_2H","mIAA","ZnT8","ICA","U_MplusU_Ratio_Zen","ECL_GADA","ECL_IA2A","ECL_IAA","Proinsulin_pM_L","PEP0")
# convert draw date to date
#keep_long$Draw_Date <- mdy_hms(as.character(keep_long$Draw_Date))
#keep_long$Draw_Date <- as.POSIXlt(as.character(keep_long$Draw_Date),format="%m%d%Y %H%M")
keep_long$Draw_Date <- mdy_hm(as.character(keep_long$Draw_Date))
keep_ppt$DOB <- mdy(as.character(keep_ppt$DOB))
# calculate fasting Cpeptide in pM/L
keep_long$PEP0_pM_L <- keep_long$PEP0*331.09
# calculate proinsulin/Cpep ratio
keep_long$Pro_pep <- keep_long$Proinsulin_pM_L/keep_long$PEP0_pM_L*100
# merge  datasets
alldata <- merge(keep_ppt,keep_long,by="Random_ID",all.x=F,all.y=F)
N <- length(unique(alldata$Random_ID))
# fix gender coding female Female   male   Male
alldata$Gender[alldata$Gender=='female'] <- "Female"
alldata$Gender[alldata$Gender=='male'] <- "Male"
# new variable for DR3/DR4
alldata$DR3DR4[alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT"] <- "PRESENT"
alldata$DR3DR4[!(alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT")] <- "ABSENT"
# combine race/ethnicity
alldata$race_eth <- NA
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic origin")]  <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic White")] <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity == "Not Hispanic or Latino")] <- "NHW"
alldata$race_eth[alldata$Ethnicity=="Hispanic" | alldata$Ethnicity=="Hispanic or Latino" | alldata$Ethnicity=="Hispanic/Latino/Spanish origin"] <- "Hispanic"
alldata$race_eth[is.na(alldata$race_eth)] <- "Other"
# labels
label(alldata$U_MplusU_Ratio_Zen)='INS ratio'
label(alldata$Pro_pep)='Proinsulin ratio'
label(alldata$Gender)='Gender'
label(alldata$DPT1Risk)="DPT1 Risk Score"
label(alldata$DR3)="DR3"
label(alldata$DR4)="DR4"
label(alldata$DR3DR4)="DR3/DR4"
# first code each antibody as positive negative
for(i in 1:nrow(alldata)){
###coding for miaa
a <-ifelse(is.na(alldata$mIAA[i]),
NA,
ifelse(alldata$mIAA[i] <= 0.01, 0, 1)
)
alldata$miaa_cat[i]<- a
###coding for first form of gad65
b <-ifelse(is.na(alldata$GAD65[i]),
NA,
ifelse(alldata$GAD65[i] <= 0.032, 0, 1)
)
alldata$gad65_cat[i]<- b
###coding for second form of gad65
c<-ifelse(is.na(alldata$GAD65H[i]),
NA,
ifelse(alldata$GAD65H[i] <= 20, 0, 1)
)
alldata$gad65h_cat[i]<- c
###coding for first form of ica512/ia2
d<-ifelse(is.na(alldata$ICA512[i]),
NA,
ifelse(alldata$ICA512[i] <= 0.049, 0, 1)
)
alldata$ica512_cat[i]<- d
###coding for second form of ica512/ia2
e<-ifelse(is.na(alldata$IA_2H[i]),
NA,
ifelse(alldata$IA_2H[i] <= 5, 0, 1)
)
alldata$ia2h_cat[i]<- e
###coding for znt8
f<-ifelse(is.na(alldata$ZnT8[i]),
NA,
ifelse(alldata$ZnT8[i] <= 0.02, 0, 1)
)
alldata$znt8_cat[i]<- f
}
#####combining both forms of gad65 tests
for(i in 1:nrow(alldata)){
test <- sum(alldata$ica512_cat[i],alldata$ia2h_cat[i],na.rm=TRUE)
de <- ifelse(is.na(alldata$ica512_cat[i]) & is.na(alldata$ia2h_cat[i]),
NA,
ifelse(test>=1,1,0))
alldata$ica512_ia2_cat[i]<- de
test2 <- sum(alldata$gad65_cat[i],alldata$gad65h_cat[i],na.rm=TRUE)
bc <- ifelse(is.na(alldata$gad65_cat[i]) & is.na(alldata$gad65h_cat[i]),
1,
ifelse(test2>=1,1,0))
alldata$GAD65_combo_cat[i]<- bc
}
# if all ab results missing, delete the record
misstwo <- alldata[is.na(alldata$mIAA) & is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$mIAA) | !is.na(alldata$miaa_cat) | !is.na(alldata$ica512_ia2_cat),]
# 36 records deleted
# check if anyone is missing GAD, ICA/IA2, or mIAA
missing <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
write.csv(missing,file="missing.csv")
# get rid of visits with missing mIAA data
missmiaa <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$GAD65_combo_cat) & !is.na(alldata$miaa_cat) & !is.na(alldata$ica512_ia2_cat),]
# 40 records deleted
# calculate number of positive ab at each visit
for(i in 1:nrow(alldata)){
alldata$numpos[i] <- sum(alldata$ica512_ia2_cat[i],alldata$GAD65_combo_cat[i],alldata$miaa_cat[i],alldata$znt8_cat[i],na.rm=T)
}
# calculate z-scores for GAD and IA2
alldata$gad65z <- (alldata$GAD65 - mean(alldata$GAD65,na.rm = TRUE))/sd(alldata$GAD65,na.rm = TRUE)
alldata$gad65hz <- (alldata$GAD65H - mean(alldata$GAD65H,na.rm = TRUE))/sd(alldata$GAD65H,na.rm = TRUE)
alldata$gadz <- ifelse(!is.na(alldata$GAD65),alldata$gad65z,alldata$gad65hz)
alldata$ica512z <- (alldata$ICA512 - mean(alldata$ICA512,na.rm = TRUE))/sd(alldata$ICA512,na.rm = TRUE)
alldata$ia2hz <- (alldata$IA_2H - mean(alldata$IA_2H,na.rm = TRUE))/sd(alldata$IA_2H,na.rm = TRUE)
alldata$ia2z <- ifelse(!is.na(alldata$ICA512),alldata$ica512z,alldata$ia2hz)
length(unique(alldata$Random_ID))
# need to find out if anyone is missing proinsulin ratio at all visits
sortds <- alldata[order(alldata$Random_ID,desc(alldata$Pro_pep)),]
hasproins <- sortds %>% group_by(Random_ID) %>% filter(row_number(Random_ID) == 1)
a <- hasproins[is.na(hasproins$Pro_pep),]
a <- a[,1]
misspro <- nrow(a)
a$flag <- rep(1,nrow(a))
# 46 subjects missing proinsulin - need to merge this back with original dataset and take those people out
# keep only those IDs that are in both dataframes
alldata <- merge(alldata,a,all.x=TRUE,by="Random_ID")
alldata <- alldata[is.na(alldata$flag),]
length(unique(alldata$Random_ID))
misspro
# need to find out if anyone is missing INS ratio at all visits
sortds <- alldata[order(alldata$Random_ID,desc(alldata$U_MplusU_Ratio_Zen)),]
hasins <- sortds %>% group_by(Random_ID) %>% filter(row_number(Random_ID) == 1)
b <- hasins[is.na(hasins$Pro_pep),]
View(b)
View(b)
b <- hasins[is.na(hasins$U_MplusU_Ratio_Zen),]
View(b)
View(b)
length(unique(alldata$Random_ID))
b <- b[,1]
missins <- nrow(b)
a$flag <- rep(1,nrow(b))
b$flag <- rep(1,nrow(b))
# subjects missing INS ratio - need to merge this back with original dataset and take those people out
# keep only those IDs that are in both dataframes
alldata <- merge(alldata,b,all.x=TRUE,by="Random_ID")
alldata <- alldata[is.na(alldata$flag),]
length(unique(alldata$Random_ID))
# read in the data
longitudinal_visit_info <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\longitudinal 091818.csv")
ParticipantInfo_risk <- read.csv("\\\\ucdenver.pvt\\som-home\\pylell\\BDC\\Steck\\Trialnet progressors analysis\\Fourth analysis - demethylated insulin with updated dataset\\Data\\Participant Info risk 091818.csv")
# get rid of duplicates
ParticipantInfo_risk <- unique(ParticipantInfo_risk)
# no duplicates
obslong <- nrow(longitudinal_visit_info)
nppt <- nrow(ParticipantInfo_risk)
# merge participant info and longitudinal data
keep_ppt <- data.frame(ParticipantInfo_risk$TrialNet,
ParticipantInfo_risk$T1D,
ParticipantInfo_risk$Date.of.Diagnosis,
ParticipantInfo_risk$DOB, ParticipantInfo_risk$Gender, ParticipantInfo_risk$Race, ParticipantInfo_risk$Ethnicity,
ParticipantInfo_risk$DPT1.Risk.Score,ParticipantInfo_risk$HLA, ParticipantInfo_risk$DR3,ParticipantInfo_risk$DR4)
colnames(keep_ppt) <- c("Random_ID","T1D","Date_of_Diagnosis","DOB","Gender",
"Race","Ethnicity","DPT1Risk","HLA","DR3","DR4")
keep_long <- data.frame(longitudinal_visit_info$PID,
longitudinal_visit_info$Draw.Date,
longitudinal_visit_info$GAD65,
longitudinal_visit_info$GAD65H,
longitudinal_visit_info$ICA512,
longitudinal_visit_info$IA2H,
longitudinal_visit_info$mIAA,
longitudinal_visit_info$ZnT8,
longitudinal_visit_info$ICA,
longitudinal_visit_info$U.per.MplusU.Ratio.Zen,
longitudinal_visit_info$ECL_GADA,
longitudinal_visit_info$ECL_IA.2A,
longitudinal_visit_info$ECL_IAA,
longitudinal_visit_info$Proinsulin_pM.L,
longitudinal_visit_info$PEP0)
colnames(keep_long) <- c("Random_ID","Draw_Date","GAD65","GAD65H","ICA512","IA_2H","mIAA","ZnT8","ICA","U_MplusU_Ratio_Zen","ECL_GADA","ECL_IA2A","ECL_IAA","Proinsulin_pM_L","PEP0")
# convert draw date to date
#keep_long$Draw_Date <- mdy_hms(as.character(keep_long$Draw_Date))
#keep_long$Draw_Date <- as.POSIXlt(as.character(keep_long$Draw_Date),format="%m%d%Y %H%M")
keep_long$Draw_Date <- mdy_hm(as.character(keep_long$Draw_Date))
keep_ppt$DOB <- mdy(as.character(keep_ppt$DOB))
# calculate fasting Cpeptide in pM/L
keep_long$PEP0_pM_L <- keep_long$PEP0*331.09
# calculate proinsulin/Cpep ratio
keep_long$Pro_pep <- keep_long$Proinsulin_pM_L/keep_long$PEP0_pM_L*100
# merge  datasets
alldata <- merge(keep_ppt,keep_long,by="Random_ID",all.x=F,all.y=F)
N <- length(unique(alldata$Random_ID))
# fix gender coding female Female   male   Male
alldata$Gender[alldata$Gender=='female'] <- "Female"
alldata$Gender[alldata$Gender=='male'] <- "Male"
# new variable for DR3/DR4
alldata$DR3DR4[alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT"] <- "PRESENT"
alldata$DR3DR4[!(alldata$DR3=="PRESENT" & alldata$DR4=="PRESENT")] <- "ABSENT"
# combine race/ethnicity
alldata$race_eth <- NA
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic origin")]  <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity=="Non-Hispanic White")] <- "NHW"
alldata$race_eth[(alldata$Race=="White" & alldata$Ethnicity == "Not Hispanic or Latino")] <- "NHW"
alldata$race_eth[alldata$Ethnicity=="Hispanic" | alldata$Ethnicity=="Hispanic or Latino" | alldata$Ethnicity=="Hispanic/Latino/Spanish origin"] <- "Hispanic"
alldata$race_eth[is.na(alldata$race_eth)] <- "Other"
# labels
label(alldata$U_MplusU_Ratio_Zen)='INS ratio'
label(alldata$Pro_pep)='Proinsulin ratio'
label(alldata$Gender)='Gender'
label(alldata$DPT1Risk)="DPT1 Risk Score"
label(alldata$DR3)="DR3"
label(alldata$DR4)="DR4"
label(alldata$DR3DR4)="DR3/DR4"
# first code each antibody as positive negative
for(i in 1:nrow(alldata)){
###coding for miaa
a <-ifelse(is.na(alldata$mIAA[i]),
NA,
ifelse(alldata$mIAA[i] <= 0.01, 0, 1)
)
alldata$miaa_cat[i]<- a
###coding for first form of gad65
b <-ifelse(is.na(alldata$GAD65[i]),
NA,
ifelse(alldata$GAD65[i] <= 0.032, 0, 1)
)
alldata$gad65_cat[i]<- b
###coding for second form of gad65
c<-ifelse(is.na(alldata$GAD65H[i]),
NA,
ifelse(alldata$GAD65H[i] <= 20, 0, 1)
)
alldata$gad65h_cat[i]<- c
###coding for first form of ica512/ia2
d<-ifelse(is.na(alldata$ICA512[i]),
NA,
ifelse(alldata$ICA512[i] <= 0.049, 0, 1)
)
alldata$ica512_cat[i]<- d
###coding for second form of ica512/ia2
e<-ifelse(is.na(alldata$IA_2H[i]),
NA,
ifelse(alldata$IA_2H[i] <= 5, 0, 1)
)
alldata$ia2h_cat[i]<- e
###coding for znt8
f<-ifelse(is.na(alldata$ZnT8[i]),
NA,
ifelse(alldata$ZnT8[i] <= 0.02, 0, 1)
)
alldata$znt8_cat[i]<- f
}
#####combining both forms of gad65 tests
for(i in 1:nrow(alldata)){
test <- sum(alldata$ica512_cat[i],alldata$ia2h_cat[i],na.rm=TRUE)
de <- ifelse(is.na(alldata$ica512_cat[i]) & is.na(alldata$ia2h_cat[i]),
NA,
ifelse(test>=1,1,0))
alldata$ica512_ia2_cat[i]<- de
test2 <- sum(alldata$gad65_cat[i],alldata$gad65h_cat[i],na.rm=TRUE)
bc <- ifelse(is.na(alldata$gad65_cat[i]) & is.na(alldata$gad65h_cat[i]),
1,
ifelse(test2>=1,1,0))
alldata$GAD65_combo_cat[i]<- bc
}
# if all ab results missing, delete the record
misstwo <- alldata[is.na(alldata$mIAA) & is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$mIAA) | !is.na(alldata$miaa_cat) | !is.na(alldata$ica512_ia2_cat),]
# 36 records deleted
# check if anyone is missing GAD, ICA/IA2, or mIAA
missing <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
write.csv(missing,file="missing.csv")
# get rid of visits with missing mIAA data
missmiaa <- alldata[is.na(alldata$GAD65_combo_cat) | is.na(alldata$miaa_cat) | is.na(alldata$ica512_ia2_cat),]
alldata <- alldata[!is.na(alldata$GAD65_combo_cat) & !is.na(alldata$miaa_cat) & !is.na(alldata$ica512_ia2_cat),]
# 40 records deleted
# calculate number of positive ab at each visit
for(i in 1:nrow(alldata)){
alldata$numpos[i] <- sum(alldata$ica512_ia2_cat[i],alldata$GAD65_combo_cat[i],alldata$miaa_cat[i],alldata$znt8_cat[i],na.rm=T)
}
# calculate z-scores for GAD and IA2
alldata$gad65z <- (alldata$GAD65 - mean(alldata$GAD65,na.rm = TRUE))/sd(alldata$GAD65,na.rm = TRUE)
alldata$gad65hz <- (alldata$GAD65H - mean(alldata$GAD65H,na.rm = TRUE))/sd(alldata$GAD65H,na.rm = TRUE)
alldata$gadz <- ifelse(!is.na(alldata$GAD65),alldata$gad65z,alldata$gad65hz)
alldata$ica512z <- (alldata$ICA512 - mean(alldata$ICA512,na.rm = TRUE))/sd(alldata$ICA512,na.rm = TRUE)
alldata$ia2hz <- (alldata$IA_2H - mean(alldata$IA_2H,na.rm = TRUE))/sd(alldata$IA_2H,na.rm = TRUE)
alldata$ia2z <- ifelse(!is.na(alldata$ICA512),alldata$ica512z,alldata$ia2hz)
# need to find out if anyone is missing proinsulin ratio at all visits
sortds <- alldata[order(alldata$Random_ID,desc(alldata$Pro_pep)),]
hasproins <- sortds %>% group_by(Random_ID) %>% filter(row_number(Random_ID) == 1)
a <- hasproins[is.na(hasproins$Pro_pep),]
a <- a[,1]
misspro <- nrow(a)
a$flag <- rep(1,nrow(a))
# 46 subjects missing proinsulin - need to merge this back with original dataset and take those people out
# keep only those IDs that are in both dataframes
alldata <- merge(alldata,a,all.x=TRUE,by="Random_ID")
alldata <- alldata[is.na(alldata$flag),]
# need to find out if anyone is missing INS ratio at all visits
sortds <- alldata[order(alldata$Random_ID,desc(alldata$U_MplusU_Ratio_Zen)),]
hasins <- sortds %>% group_by(Random_ID) %>% filter(row_number(Random_ID) == 1)
b <- hasins[is.na(hasins$U_MplusU_Ratio_Zen),]
b <- b[,1]
missins <- nrow(b)
b$flag <- rep(1,nrow(b))
# subjects missing INS ratio - need to merge this back with original dataset and take those people out
# keep only those IDs that are in both dataframes
alldata <- merge(alldata,b,all.x=TRUE,by="Random_ID")
alldata <- alldata[is.na(alldata$flag),]
